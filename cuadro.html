<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Cuadro de Enfrentamientos</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f4f6f9;
  }
  h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 30px;
  }
  .cuadro {
    display: grid;
    grid-template-columns: repeat(3, 220px);
    grid-auto-rows: 100px;
    gap: 40px 60px;
    padding: 20px 40px;
  }
  .ronda-titulo {
    font-weight: bold;
    font-size: 18px;
    text-align: center;
    color: #34495e;
    margin-bottom: 10px;
    grid-column: span 1;
  }
  .partido {
    background: white;
    border: 2px solid #2980b9;
    border-radius: 6px;
    padding: 10px 15px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: center;
  }
  .ganador {
    margin-top: 8px;
    font-weight: bold;
    color: #27ae60;
  }
</style>
</head>
<body>
  <h1>Cuadro de Enfrentamientos</h1>
  <div class="cuadro" id="cuadro"></div>

  <script>
    const URL_CSV_CUADRO = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2l16Kde53D3FF6PNIq9Rtqq7qpRagrh8lbZUGGvJebtbaZQnpeqCIl-oz4uEHYTzIHo0NESBGGQcO/pub?gid=1648244325&single=true&output=csv";

    function parseCSV(text) {
      const lines = text.trim().split("\n");
      const result = [];
      let insideQuotes = false;
      let field = "";
      let row = [];

      for(let i=1; i<lines.length; i++) { // saltar header
        const line = lines[i];
        insideQuotes = false;
        field = "";
        row = [];
        for(let j=0; j<line.length; j++) {
          const char = line[j];
          if(char === '"') {
            insideQuotes = !insideQuotes;
          } else if(char === ',' && !insideQuotes) {
            row.push(field.trim());
            field = "";
          } else {
            field += char;
          }
        }
        row.push(field.trim());
        result.push(row);
      }
      return result;
    }

    function crearPartidoHTML(eq1, eq2, ganador) {
      const div = document.createElement('div');
      div.className = 'partido';
      div.innerHTML = `
        <div>${eq1}</div>
        <div>vs</div>
        <div>${eq2}</div>
        <div class="ganador">Ganador: ${ganador}</div>
      `;
      return div;
    }

    async function cargarCuadro() {
      try {
        const res = await fetch(URL_CSV_CUADRO);
        const csv = await res.text();
        const datos = parseCSV(csv);

        // Agrupar partidos por ronda
        const rondas = {};
        datos.forEach(([ronda, id, eq1, eq2, ganador]) => {
          if(!rondas[ronda]) rondas[ronda] = [];
          rondas[ronda].push({ id, eq1, eq2, ganador });
        });

        // Orden fijo de rondas:
        const ordenRondas = ["Cuartos", "Semifinal", "Final"];

        const cuadroDiv = document.getElementById("cuadro");
        cuadroDiv.innerHTML = "";

        ordenRondas.forEach((ronda, i) => {
          // TÃ­tulo ronda
          const titulo = document.createElement("div");
          titulo.className = "ronda-titulo";
          titulo.textContent = ronda;
          titulo.style.gridColumn = i + 1;
          cuadroDiv.appendChild(titulo);

          if(rondas[ronda]) {
            // Ordenar por id para orden correcto
            rondas[ronda].sort((a,b) => Number(a.id) - Number(b.id));
            rondas[ronda].forEach(({ eq1, eq2, ganador }) => {
              const partidoDiv = crearPartidoHTML(eq1, eq2, ganador);
              partidoDiv.style.gridColumn = i + 1;
              cuadroDiv.appendChild(partidoDiv);
            });
          }
        });

      } catch (err) {
        console.error("Error cargando cuadro:", err);
        document.getElementById("cuadro").textContent = "Error cargando datos del cuadro.";
      }
    }

    cargarCuadro();
  </script>
</body>
</html>
